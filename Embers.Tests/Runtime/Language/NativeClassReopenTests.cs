namespace Embers.Tests
{
    [TestClass]
    public class NativeClassReopenTests
    {
        [TestMethod]
        public void ReopenStringAddsMethod()
        {
            Machine machine = new();
            var result = machine.ExecuteText("class String; def shout; 'ok'; end; end; 'hi'.shout");
            Assert.AreEqual("ok", result);
        }

        [TestMethod]
        public void ReopenStringOverridesStdLib()
        {
            Machine machine = new();
            var result = machine.ExecuteText("class String; def length; 999; end; end; 'hi'.length");
            Assert.AreEqual(999L, result);
        }

        [TestMethod]
        public void ReopenFixnumAddsMethod()
        {
            Machine machine = new();
            var result = machine.ExecuteText("class Fixnum; def ping; 7; end; end; 1.ping");
            Assert.AreEqual(7L, result);
        }

        [TestMethod]
        public void StdLibStillResolvesAfterReopen()
        {
            Machine machine = new();
            var result = machine.ExecuteText("class String; def shout; 'ok'; end; end; 'hi'.upcase");
            Assert.AreEqual("HI", result);
        }
    }
}
